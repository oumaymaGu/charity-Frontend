<app-navbar></app-navbar>

<div class="col-md-3 sidebar">
  <app-sidebar></app-sidebar>
</div>

<div class="content mt-4">
  <h2 class="text-center text-dark mb-4">Stocks</h2>

  <div *ngIf="error" class="alert alert-danger text-center">
    ‚ùå {{ error }}
  </div>

  <div class="mb-3">
    <input type="text" [(ngModel)]="searchTerm" class="form-control" placeholder="Search by ID" (input)="searchStock()" />
  </div>

  <div *ngIf="loading" class="spinner-border" role="status">
    <span class="sr-only">Chargement...</span>
  </div>

  <table *ngIf="!loading && stocks.length > 0" class="table table-bordered table-striped table-hover shadow-sm">
    <thead class="table-primary">
      <tr>
        <th>Capacit√© Totale</th>
        <th>Type</th>
        <th>Lieu</th>
        <th>Association</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let stock of stocks" [ngClass]="{'table-danger': isStockCritique(stock)}">

        <td>{{ stock.capaciteDisponible }} / {{ stock.capaciteTotale }}</td>

       <td>{{ stock.typeStock }}</td>
        <td>{{ stock.lieu }}</td>
        <td>{{ stock.associations?.nomAss || 'Non affect√©e' }}</td>
        <td>
          <button class="btn btn-sm btn-outline-success me-2" (click)="modifierStock(stock)">‚úè Modifier</button>
          <button class="btn btn-sm btn-outline-danger" (click)="deleteStock(stock.idStock)">üóë Supprimer</button>
          <button class="btn btn-sm btn-outline-warning" (click)="ouvrirModaleRetrait(stock)">üõí Retrait</button>
        </td>
      </tr>
    </tbody>
  </table>

  <div *ngIf="stocks.length === 0 && !loading" class="alert alert-warning text-center">
    üòï Aucun stock disponible.
  </div>
</div>

<app-stock-retrait
  *ngIf="stockSelectionnePourRetrait"
  [stock]="stockSelectionnePourRetrait"
  (retraitEffectue)="refreshStocks()"
  (fermerModal)="fermerModaleRetrait()">
</app-stock-retrait>



<style>
  /* Assurer que la page n‚Äôa pas de marges inutiles */
  body, html {
    margin: 0;
    padding: 0;
    height: 100%;
  }

  .container-fluid {
    padding: 0;
  }

  .row {
    margin: 0;
    display: flex;
  }

  /* Sidebar */
  .sidebar {
    background-color: #212529 !important; /* Noir Bootstrap */
    color: white;
    padding: 20px;
    border-right: 1px solid #dee2e6;
    height: 100vh;
    position: fixed;
    width: 250px;
    display: flex;
    flex-direction: column;
    overflow-y: auto;
  }

  /* Contenu */
  .content {
    margin-left: 250px; /* D√©caler le contenu */
    padding: 30px;
    width: calc(100% - 250px);
    background-color: #ffffff; /* Fond blanc pour la page */
  }

  /* Formulaire et Table */
  .form-group label {
    font-weight: bold;
  }

  .btn-primary {
    margin-top: 10px;
  }

  /* Table style */
  .table {
    margin-top: 20px;
  }

  /* Boutons d'actions dans la table */
  .btn-sm {
    margin-right: 5px;
  }

  .table-hover tbody tr:hover {
    background-color: #f1f1f1;
  }

  .table-primary {
    background-color: #007bff;
    color: white;
  }

  .table-bordered th, .table-bordered td {
    border: 1px solid #dee2e6;
  }

  /* Spinner */
  .spinner-border {
    display: block;
    margin: 0 auto;
  }
</style>




